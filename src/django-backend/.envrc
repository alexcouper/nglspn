# Auto-activate Python virtual environment when entering directory
# Requires direnv: https://direnv.net/

# Create virtual environment if it doesn't exist
if [[ ! -d ".venv" ]]; then
    echo "Creating virtual environment with uv..."
    uv venv
fi

# Activate the virtual environment
source .venv/bin/activate

# Install dependencies if they're not installed or lockfile is newer
if [[ ! -f ".venv/.deps_installed" ]] || [[ "uv.lock" -nt ".venv/.deps_installed" ]] || [[ "pyproject.toml" -nt ".venv/.deps_installed" ]]; then
    echo "Installing dependencies with uv sync..."
    uv sync --dev --test
    touch .venv/.deps_installed
fi

# Load environment variables from .env if it exists
if [[ -f ".env" ]]; then
    dotenv .env
fi
